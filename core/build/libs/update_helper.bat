@echo off
echo Утилита для применения обновлений ROGAL
echo =======================================

:: Проверка наличия параметров
if "%~1"=="" (
    echo Ошибка: не указан файл новой версии
    echo Использование: %~nx0 путь_к_новому_файлу [старый_файл_для_удаления]
    pause
    exit /b 1
)

:: Проверка существования нового файла
if not exist "%~1" (
    echo Ошибка: файл новой версии не найден: %~1
    pause
    exit /b 1
)

echo Ожидание завершения работы предыдущей версии...
timeout /t 2 /nobreak > nul

:: Удаление старого файла, если он указан
if not "%~2"=="" (
    if exist "%~2" (
        echo Удаление старой версии: %~2
        del "%~2"
        if errorlevel 1 (
            echo Предупреждение: не удалось удалить старый файл
        )
    ) else (
        echo Старый файл не найден: %~2
    )
)

:: Запуск новой версии
echo Запуск новой версии: %~1
start "" "%~1"
if errorlevel 1 (
    echo Ошибка при запуске новой версии!
    pause
    exit /b 1
)

echo Обновление успешно применено.
timeout /t 3 /nobreak > nul
exit /b 0
